# =========================================================================================
# PROJECT CONFIGURATION FILE
# =========================================================================================
# This YAML file configures the RNA-seq pipeline. The pipeline reads this file to:
#   1. Locate input FASTQ files (read_dir)
#   2. Find reference genome files (reference section)
#   3. Set output locations (base_dir, work_dir)
#   4. Configure alignment/quantification tools (star_align, salmon_quant)
#
# Usage:
#   nextflow run main.nf -params-file project_info.yaml
#
# Quick Start:
#   1. Set project name, species, genome_version
#   2. Verify reference paths (ref_dir, fasta_file, gtf_file)
#   3. Set read_dir to your FASTQ location
#   4. Leave STAR/Salmon defaults unchanged (unless specific needs)
# =========================================================================================

# -----------------------------------------------------------------------------------------
# PROJECT METADATA
# -----------------------------------------------------------------------------------------

project: "Xinyi"                  # Project name (used in output directory naming)
expt: "RNASeq"                    # Experiment type (determines output structure)
assay: "RNA"                      # Assay type (metadata only)

# -----------------------------------------------------------------------------------------
# REFERENCE GENOME PATHS
# -----------------------------------------------------------------------------------------
# CRITICAL: Files MUST be organized as:
#
#   ref_dir/
#   └── Human/                      ← Species folder (REQUIRED!)
#       ├── Homo_sapiens.GRCh38.dna.primary_assembly.fa
#       └── Homo_sapiens.GRCh38.113.gtf
#
# Pipeline constructs full paths as: ${ref_dir}/${species}/${fasta_file}
# Storing files directly in ref_dir (without species subfolder) will ERROR!
# -----------------------------------------------------------------------------------------

reference:
  ref_dir: "/hpc/home/kailasamms/NGSTools/Reference_Genomes"
  fasta_file: "Homo_sapiens.GRCh38.dna.primary_assembly.fa"
  gtf_file: "Homo_sapiens.GRCh38.113.gtf"
  species: "Human"           # Must match folder name in ref_dir: "Human", "Mouse", etc.
  genome_version: "GRCh38"   # For documentation: "GRCh38", "GRCm39", etc.

# # Mouse example (uncomment to switch):
# reference:
#   ref_dir: "/hpc/home/kailasamms/NGSTools/Reference_Genomes"
#   fasta_file: "Mus_musculus.GRCm39.dna.primary_assembly.fa"
#   gtf_file: "Mus_musculus.GRCm39.113.gtf"
#   species: "Mouse"
#   genome_version: "GRCm39"

# -----------------------------------------------------------------------------------------
# INPUT/OUTPUT DIRECTORIES
# -----------------------------------------------------------------------------------------

map_file: "/hpc/home/kailasamms/scripts/nextflow/projects/Xinyi_map.txt"

# Input: Directory containing raw FASTQ files
# Expected naming: *_R1.fq.gz, *_R2.fq.gz (or _r1, _r2, .fastq.gz)
# See docs/validate_input.md for file naming requirements
read_dir: "/hpc/home/kailasamms/scratch/RNASeq/Xinyi/01.FastQ/raw"

# Output: Base directory for all pipeline results
# Final structure: ${base_dir}/${expt}/${project}/01.FastQC/, 02.STAR/, etc.
base_dir: "/hpc/home/kailasamms/scratch"

# Work: Nextflow intermediate files (enables -resume, can delete after completion)
work_dir: "/hpc/home/kailasamms/scratch/nf_work"

# Cache: Container image storage (can be shared across projects)
cache_dir: "/hpc/home/kailasamms/NGSTools/singularity_cache"

# Cloud storage examples:
# base_dir: "s3://my-nextflow-bucket"
# work_dir: "s3://my-nextflow-bucket/work"

# =========================================================================================
# ALIGNMENT PARAMETERS
# =========================================================================================
# These are passed to STAR alignment. Defaults work well for standard RNA-seq.
# For parameter details, see: docs/star_align.md
#
# Advanced users: Modify values as needed
# Standard users: Leave defaults unchanged
# =========================================================================================

star_align:
  runMode: "alignReads"
  twopassMode: "Basic"                        # Novel junction discovery (2-5% better mapping)
  quantMode: "GeneCounts"                     # Generate gene counts for DESeq2/edgeR
  sjdbOverhang: 100                           # ReadLength - 1 (100 works for 75-150bp reads)
  readFilesCommand: "zcat"                    # For .gz files
  outFilterMultimapNmax: 10                   # Allow reads mapping to ≤10 loci
  outFilterMismatchNmax: 999                  # Use percentage filter (below)
  outFilterMismatchNoverReadLmax: 0.04        # Max 4% mismatches per read
  outFilterType: "BySJout"                    # Filter low-confidence junctions
  alignEndsType: "Local"                      # Allow soft-clipping at ends
  alignIntronMin: 20                          # Min intron size (gaps <20bp = deletions)
  alignIntronMax: 1000000                     # Max intron size (1 Mb)
  alignMatesGapMax: 1000000                   # Max distance between PE mates
  outSAMattributes: "NH HI AS nM MD"          # MD tag needed for RSeQC
  outSAMunmapped: "Within"                    # Include unmapped reads in BAM
  outSAMtype: ["BAM", "SortedByCoordinate"]   # Sorted BAM output

# =========================================================================================
# QUANTIFICATION PARAMETERS
# =========================================================================================
# These are passed to Salmon quantification. Defaults enable bias corrections.
# For parameter details, see: docs/salmon_quant.md
#
# Advanced users: Modify values as needed
# Standard users: Leave defaults unchanged
# =========================================================================================

salmon_quant:
  libType: "IU"      # Forced to Unstranded (IU) instead of Auto-detect (A)
 # libType: "A"      # Auto-detect library type (strand orientation)
  gcBias: true      # Correct GC content bias (~5% improvement)
  seqBias: true     # Correct hexamer priming bias (~3% improvement)
  posBias: true     # Correct positional bias (~2% improvement)
